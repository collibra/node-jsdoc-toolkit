<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:signavio="http://www.signavio.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" exporter="Signavio Process Editor, http://www.signavio.com" exporterVersion="" id="sid-3c489618-1c79-4229-b443-9bda1dd48a3f" targetNamespace="http://www.signavio.com/bpmn20" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">
   <process id="Review_Process" isExecutable="true" name="Review_Process">
      <extensionElements>
      	<activiti:executionListener class="com.collibra.dgc.core.workflow.activiti.executionlistener.ReviewProcessRACIInitializer" event="start">
	      		<!-- Responsible - This role is mandatory -->
	      		<activiti:field name="responsibleRole" stringValue="Admin(Community)" />
	      		<!-- Accountable -->
	      		<activiti:field name="accountableRole" stringValue="Admin(Community), Steward(Community)" />
	      		<!-- Consulted - This role is mandatory -->
	      		<activiti:field name="consultedRole" stringValue="Stakeholder(Community)" />
	      		
	      		<!-- State of the representation when the process starts -->	      		
	      		<activiti:field name="targetState" stringValue="Under Review" />	      		
      	</activiti:executionListener>
      </extensionElements> 
   
      <startEvent id="StartNoneEvent" name="StartNoneEvent" activiti:formKey="WorkflowCode.VocabularyEntryWorkflowStart" />
      
      <!-- Review the certain resource task assigned to each (multi-instance parallel user task) 'Consulted' users. -->   
      <userTask id="Review" name="Review">
         <documentation id="sid-412b6a38-1207-435c-a44a-9a247fcd0fd9">bsg.workflow.Review_Process.task.Review</documentation>
         <extensionElements>
    		<activiti:taskListener event="create" class="com.collibra.dgc.core.workflow.activiti.tasklistener.ReviewStartTaskListener" />
  		 </extensionElements>
         
     	 <humanPerformer>
			<resourceAssignmentExpression>
				<formalExpression>#{reviewer}</formalExpression>
			</resourceAssignmentExpression>
		 </humanPerformer>
         
         <multiInstanceLoopCharacteristics behavior="All" id="sid-90aa887b-58fb-4418-8bd1-260742f24f58" isSequential="false">
			<loopDataInputRef>reviewers</loopDataInputRef>
    		<inputDataItem name="reviewer" />                  
         </multiInstanceLoopCharacteristics>
      </userTask>
      
      <!-- Consolidate the review and comments given by the reviewer task is assigned to 'Responsible' users-->
      <userTask id="Consolidation" name="Consolidate">
         <documentation id="sid-3a748571-9f6b-4c72-b88b-3f3fd8773735">bsg.workflow.Review_Process.task.Consolidation</documentation>
         <extensionElements>
            <activiti:taskListener event="create" class="com.collibra.dgc.core.workflow.activiti.tasklistener.ResponsibleUsersInjector" />
            <activiti:taskListener event="complete" class="com.collibra.dgc.core.workflow.activiti.tasklistener.CosolidationCompletedTaskListener" >
            	<!-- State of the representation when the process starts -->	      		
	      		<activiti:field name="targetState" stringValue="Reviewed" />	      		
            </activiti:taskListener>
         </extensionElements>
      </userTask>
      
      <exclusiveGateway gatewayDirection="Diverging" id="Exclusive_Databased_Gateway" name="Exclusive_Databased_Gateway">
         <extensionElements>
            
         </extensionElements>
      </exclusiveGateway>
      
      <!-- Close or continue to consolidation assigned to 'Responsible' users if the review is not completed by all 'Consulted' users -->
      <userTask id="Review_Not_Done" name="Review Not Done" activiti:formKey="WorkflowCode.ReviewWorkflowReviewNotDone">
         <documentation id="sid-dafae97d-5f49-4b6f-a498-942405591e28">bsg.workflow.Review_Process.task.Review_Not_Done</documentation>
         <extensionElements>
            <activiti:taskListener event="create" class="com.collibra.dgc.core.workflow.activiti.tasklistener.ResponsibleUsersInjector" />
         </extensionElements>
      </userTask>
      
      <!-- Timer for completing the review task -->
      <boundaryEvent attachedToRef="Review" cancelActivity="true" id="IntermediateTimerEvent" name="IntermediateTimerEvent">
         <documentation>Timer for completing the review task</documentation>
         <timerEventDefinition id="sid-ba2d1677-8f37-4c3e-8254-62df566c9c21">
         	<timeDuration>P7D</timeDuration> <!-- 7 days -->
         </timerEventDefinition>
      </boundaryEvent>
      
      <endEvent id="EndNoneEvent" name="EndNoneEvent" />
      
      <!-- Sends email notification to Accountable and Consulted  -->
      <serviceTask id="Notify" name="Notify" activiti:type="mail">
      	 <documentation>Sends email notification to Accountable and Consulted</documentation>
         <extensionElements>
		    <activiti:field name="from" stringValue="glossary@collibra.com" />
		    <activiti:field name="to" expression="${toEmail}" />
		    <activiti:field name="subject" expression="Review Completed" />
		    <activiti:field name="html">
		      <activiti:expression>
		        <![CDATA[
		          <html>
		            <body>
		              Hello!<br/><br/>
		              Review completed for the term <a href="${representationURL}"> ${representationName}</a> has been reviewed by ${sender}.<br /><br/>	              
		            </body>
		          </html>
		        ]]>
		      </activiti:expression>
		    </activiti:field>            
         </extensionElements>
      </serviceTask>
      
      <endEvent id="EndNoneEvent_2" name="EndNoneEvent" />
      
      <sequenceFlow id="SequenceFlow" name="SequenceFlow" sourceRef="StartNoneEvent" targetRef="Review" />
      <sequenceFlow id="SequenceFlow_3" name="SequenceFlow" sourceRef="Review" targetRef="Consolidation" />
      <sequenceFlow id="SequenceFlow_4" name="SequenceFlow" sourceRef="Consolidation" targetRef="Notify" />
      <sequenceFlow id="SequenceFlow_6" name="SequenceFlow" sourceRef="Notify" targetRef="EndNoneEvent_2" />
      <sequenceFlow id="SequenceFlow_5" name="SequenceFlow" sourceRef="IntermediateTimerEvent" targetRef="Review_Not_Done" />
      <sequenceFlow id="SequenceFlow_2" name="SequenceFlow" sourceRef="Review_Not_Done" targetRef="Exclusive_Databased_Gateway" />
      <sequenceFlow id="Consolidate" name="Consolidate" sourceRef="Exclusive_Databased_Gateway" targetRef="Consolidation">
      	<conditionExpression id="sid-3cb21580-af47-4edb-bbe3-8ba275bcccd8_Consolidate" xsi:type="tFormalExpression">${!close}</conditionExpression>
      </sequenceFlow>
      <sequenceFlow id="Close" name="Close" sourceRef="Exclusive_Databased_Gateway" targetRef="EndNoneEvent">
      	<conditionExpression id="sid-ed3d3d00-59cd-4fdf-ab4a-a06de5283d8b_Close" xsi:type="tFormalExpression">${close}</conditionExpression>
      </sequenceFlow>
   </process>
   
   <!-- bpmndi:BPMNDiagram id="sid-f319e5f9-f2ab-475d-811f-89263fdcdfaa">
      <bpmndi:BPMNPlane bpmnElement="Review_Process" id="sid-a771b626-0af2-44dc-be46-7f94a90b6387">
         <bpmndi:BPMNShape bpmnElement="StartNoneEvent" id="StartNoneEvent_gui">
            <omgdc:Bounds height="30.0" width="30.0" x="140.0" y="131.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="Review" id="Review_gui">
            <omgdc:Bounds height="80.0" width="100.0" x="215.0" y="106.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="Consolidation" id="Consolidation_gui">
            <omgdc:Bounds height="80.0" width="100.0" x="495.0" y="106.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="Exclusive_Databased_Gateway" id="Exclusive_Databased_Gateway_gui" isMarkerVisible="true">
            <omgdc:Bounds height="40.0" width="40.0" x="525.0" y="275.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="Review_Not_Done" id="Review_Not_Done_gui">
            <omgdc:Bounds height="80.0" width="100.0" x="330.0" y="255.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="IntermediateTimerEvent" id="IntermediateTimerEvent_gui">
            <omgdc:Bounds height="30.0" width="30.0" x="280.071923828125" y="171.0958984375"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="EndNoneEvent" id="EndNoneEvent_gui">
            <omgdc:Bounds height="28.0" width="28.0" x="645.0" y="281.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="Notify" id="Notify_gui">
            <omgdc:Bounds height="80.0" width="100.0" x="640.0" y="106.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNShape bpmnElement="EndNoneEvent_2" id="EndNoneEvent_2_gui">
            <omgdc:Bounds height="28.0" width="28.0" x="785.0" y="132.0"/>
         </bpmndi:BPMNShape>
         <bpmndi:BPMNEdge bpmnElement="Consolidate" id="Consolidate_gui">
            <omgdi:waypoint x="545.0" y="275.0"/>
            <omgdi:waypoint x="545.0" y="186.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="Close" id="Close_gui">
            <omgdi:waypoint x="565.0" y="295.0"/>
            <omgdi:waypoint x="645.0" y="295.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow_6" id="SequenceFlow_6_gui">
            <omgdi:waypoint x="740.0" y="146.0"/>
            <omgdi:waypoint x="785.0" y="146.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow_4" id="SequenceFlow_4_gui">
            <omgdi:waypoint x="595.0" y="146.0"/>
            <omgdi:waypoint x="640.0" y="146.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow_5" id="SequenceFlow_5_gui">
            <omgdi:waypoint x="295.0" y="201.0"/>
            <omgdi:waypoint x="295.071923828125" y="295.0"/>
            <omgdi:waypoint x="330.0" y="295.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow_2" id="SequenceFlow_2_gui">
            <omgdi:waypoint x="430.0" y="295.0"/>
            <omgdi:waypoint x="525.0" y="295.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow_3" id="SequenceFlow_3_gui">
            <omgdi:waypoint x="315.0" y="146.0"/>
            <omgdi:waypoint x="495.0" y="146.0"/>
         </bpmndi:BPMNEdge>
         <bpmndi:BPMNEdge bpmnElement="SequenceFlow" id="SequenceFlow_gui">
            <omgdi:waypoint x="170.0" y="146.0"/>
            <omgdi:waypoint x="215.0" y="146.0"/>
         </bpmndi:BPMNEdge>
      </bpmndi:BPMNPlane>
   </bpmndi:BPMNDiagram-->
</definitions>